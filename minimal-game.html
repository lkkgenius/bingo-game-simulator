<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BingoéŠæˆ²æ¨¡æ“¬å™¨ - ç°¡åŒ–ç‰ˆ</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>BingoéŠæˆ²æ¨¡æ“¬å™¨</h1>
            <p>èˆ‡é›»è…¦é€²è¡Œ8è¼ªç¿»ç‰ŒéŠæˆ²ï¼Œç›®æ¨™æ˜¯å®Œæˆæœ€å¤šçš„é€£ç·šï¼</p>
        </header>

        <main>
            <div class="game-status">
                <div class="status-item">
                    <span class="label">ç•¶å‰è¼ªæ•¸</span>: <span id="current-round">1</span> / 8
                </div>
                <div class="status-item">
                    <span class="label">éŠæˆ²éšæ®µ</span>: <span id="game-phase">ç­‰å¾…é–‹å§‹</span>
                </div>
                <div class="status-item">
                    <span class="label">å®Œæˆé€£ç·š</span>: <span id="completed-lines">0</span>
                </div>
            </div>

            <div id="game-board" class="game-board"></div>

            <div class="board-controls">
                <button id="start-game" class="primary-btn">é–‹å§‹éŠæˆ²</button>
                <button id="restart-game" class="secondary-btn" disabled>é‡æ–°é–‹å§‹</button>
                <button id="random-computer-move" class="secondary-btn">é›»è…¦éš¨æ©Ÿä¸‹æ£‹</button>
            </div>

            <div class="suggestion-area">
                <h3>å»ºè­°ç§»å‹•</h3>
                <div id="suggestion-display">
                    <span id="suggestion-text">é»æ“Šé–‹å§‹éŠæˆ²ç²å¾—å»ºè­°</span>
                </div>
            </div>
        </main>
    </div>

    <script>
        console.log('ğŸ® Starting minimal game initialization...');
        
        // ç°¡åŒ–çš„éŠæˆ²ç‹€æ…‹
        let gameState = {
            board: Array(5).fill().map(() => Array(5).fill(0)),
            currentRound: 1,
            gamePhase: 'waiting',
            gameStarted: false,
            gameEnded: false,
            completedLines: []
        };

        // ç°¡åŒ–çš„é€£ç·šæª¢æ¸¬
        function checkLines(board) {
            const lines = [];
            
            // æª¢æŸ¥æ°´å¹³ç·š
            for (let row = 0; row < 5; row++) {
                if (board[row].every(cell => cell !== 0)) {
                    lines.push({ type: 'horizontal', row });
                }
            }
            
            // æª¢æŸ¥å‚ç›´ç·š
            for (let col = 0; col < 5; col++) {
                if (board.every(row => row[col] !== 0)) {
                    lines.push({ type: 'vertical', col });
                }
            }
            
            // æª¢æŸ¥å°è§’ç·š
            if (board.every((row, i) => row[i] !== 0)) {
                lines.push({ type: 'diagonal', direction: 'main' });
            }
            
            if (board.every((row, i) => row[4-i] !== 0)) {
                lines.push({ type: 'diagonal', direction: 'anti' });
            }
            
            return lines;
        }

        // ç°¡åŒ–çš„å»ºè­°ç³»çµ±
        function getBestSuggestion(board) {
            const emptyCells = [];
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    if (board[row][col] === 0) {
                        emptyCells.push({ row, col });
                    }
                }
            }
            
            if (emptyCells.length === 0) return null;
            
            // ç°¡å–®ç­–ç•¥ï¼šå„ªå…ˆé¸æ“‡ä¸­å¿ƒä½ç½®
            const centerCell = emptyCells.find(cell => cell.row === 2 && cell.col === 2);
            if (centerCell) return centerCell;
            
            // å¦å‰‡éš¨æ©Ÿé¸æ“‡
            return emptyCells[Math.floor(Math.random() * emptyCells.length)];
        }

        // å‰µå»ºéŠæˆ²æ¿
        function createGameBoard() {
            const boardElement = document.getElementById('game-board');
            boardElement.innerHTML = '';
            
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'game-cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    cell.addEventListener('click', () => handleCellClick(row, col));
                    boardElement.appendChild(cell);
                }
            }
        }

        // è™•ç†æ ¼å­é»æ“Š
        function handleCellClick(row, col) {
            if (!gameState.gameStarted || gameState.gameEnded) return;
            if (gameState.board[row][col] !== 0) return;
            
            if (gameState.gamePhase === 'player-turn') {
                gameState.board[row][col] = 1; // ç©å®¶
                updateBoard();
                gameState.gamePhase = 'computer-turn';
                updateUI();
                showPlayerSuggestion();
            } else if (gameState.gamePhase === 'computer-turn') {
                gameState.board[row][col] = 2; // é›»è…¦
                updateBoard();
                nextRound();
            }
        }

        // æ›´æ–°éŠæˆ²æ¿é¡¯ç¤º
        function updateBoard() {
            const cells = document.querySelectorAll('.game-cell');
            cells.forEach((cell, index) => {
                const row = Math.floor(index / 5);
                const col = index % 5;
                const value = gameState.board[row][col];
                
                cell.className = 'game-cell';
                if (value === 1) cell.classList.add('player');
                if (value === 2) cell.classList.add('computer');
            });
            
            // æª¢æŸ¥é€£ç·š
            gameState.completedLines = checkLines(gameState.board);
            document.getElementById('completed-lines').textContent = gameState.completedLines.length;
        }

        // ä¸‹ä¸€è¼ª
        function nextRound() {
            if (gameState.currentRound >= 8) {
                endGame();
            } else {
                gameState.currentRound++;
                gameState.gamePhase = 'player-turn';
                updateUI();
                showPlayerSuggestion();
            }
        }

        // çµæŸéŠæˆ²
        function endGame() {
            gameState.gameEnded = true;
            gameState.gamePhase = 'game-over';
            updateUI();
            
            const lines = gameState.completedLines.length;
            alert(`éŠæˆ²çµæŸï¼å®Œæˆäº† ${lines} æ¢é€£ç·šï¼`);
        }

        // æ›´æ–° UI
        function updateUI() {
            document.getElementById('current-round').textContent = gameState.currentRound;
            document.getElementById('game-phase').textContent = 
                gameState.gamePhase === 'player-turn' ? 'ç©å®¶å›åˆ' :
                gameState.gamePhase === 'computer-turn' ? 'é›»è…¦å›åˆ' :
                gameState.gamePhase === 'game-over' ? 'éŠæˆ²çµæŸ' : 'ç­‰å¾…é–‹å§‹';
            
            document.getElementById('restart-game').disabled = !gameState.gameStarted;
        }

        // é¡¯ç¤ºç©å®¶å»ºè­°
        function showPlayerSuggestion() {
            const suggestion = getBestSuggestion(gameState.board);
            const suggestionText = document.getElementById('suggestion-text');
            
            if (suggestion) {
                suggestionText.textContent = `å»ºè­°ä½ç½®ï¼šç¬¬${suggestion.row + 1}è¡Œç¬¬${suggestion.col + 1}åˆ—`;
            } else {
                suggestionText.textContent = 'æ²’æœ‰å¯ç”¨ä½ç½®';
            }
        }

        // é–‹å§‹éŠæˆ²
        function startGame() {
            gameState = {
                board: Array(5).fill().map(() => Array(5).fill(0)),
                currentRound: 1,
                gamePhase: 'player-turn',
                gameStarted: true,
                gameEnded: false,
                completedLines: []
            };
            
            updateBoard();
            updateUI();
            showPlayerSuggestion();
            
            document.getElementById('start-game').disabled = true;
        }

        // é‡æ–°é–‹å§‹
        function restartGame() {
            startGame();
            document.getElementById('start-game').disabled = false;
        }

        // é›»è…¦éš¨æ©Ÿç§»å‹•
        function makeRandomComputerMove() {
            if (gameState.gamePhase !== 'computer-turn') return;
            
            const emptyCells = [];
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    if (gameState.board[row][col] === 0) {
                        emptyCells.push({ row, col });
                    }
                }
            }
            
            if (emptyCells.length > 0) {
                const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                handleCellClick(randomCell.row, randomCell.col);
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ® Initializing minimal game...');
            
            // æª¢æŸ¥å¿…è¦çµ„ä»¶
            const missingComponents = [];
            if (typeof ProbabilityCalculator === 'undefined') missingComponents.push('ProbabilityCalculator');
            if (typeof GameEngine === 'undefined') missingComponents.push('GameEngine');
            
            if (missingComponents.length > 0) {
                console.error('Missing components:', missingComponents);
            }
            
            createGameBoard();
            updateUI();
            
            // äº‹ä»¶ç›£è½å™¨
            document.getElementById('start-game').addEventListener('click', startGame);
            document.getElementById('restart-game').addEventListener('click', restartGame);
            document.getElementById('random-computer-move').addEventListener('click', makeRandomComputerMove);
            
            console.log('âœ… Minimal game initialized successfully!');
        });
    </script>
</body>
</html>