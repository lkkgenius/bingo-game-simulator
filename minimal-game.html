<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo遊戲模擬器 - 簡化版</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Bingo遊戲模擬器</h1>
            <p>與電腦進行8輪翻牌遊戲，目標是完成最多的連線！</p>
        </header>

        <main>
            <div class="game-status">
                <div class="status-item">
                    <span class="label">當前輪數</span>: <span id="current-round">1</span> / 8
                </div>
                <div class="status-item">
                    <span class="label">遊戲階段</span>: <span id="game-phase">等待開始</span>
                </div>
                <div class="status-item">
                    <span class="label">完成連線</span>: <span id="completed-lines">0</span>
                </div>
            </div>

            <div id="game-board" class="game-board"></div>

            <div class="board-controls">
                <button id="start-game" class="primary-btn">開始遊戲</button>
                <button id="restart-game" class="secondary-btn" disabled>重新開始</button>
                <button id="random-computer-move" class="secondary-btn">電腦隨機下棋</button>
            </div>

            <div class="suggestion-area">
                <h3>建議移動</h3>
                <div id="suggestion-display">
                    <span id="suggestion-text">點擊開始遊戲獲得建議</span>
                </div>
            </div>
        </main>
    </div>

    <script>
        console.log('🎮 Starting minimal game initialization...');
        
        // 簡化的遊戲狀態
        let gameState = {
            board: Array(5).fill().map(() => Array(5).fill(0)),
            currentRound: 1,
            gamePhase: 'waiting',
            gameStarted: false,
            gameEnded: false,
            completedLines: []
        };

        // 簡化的連線檢測
        function checkLines(board) {
            const lines = [];
            
            // 檢查水平線
            for (let row = 0; row < 5; row++) {
                if (board[row].every(cell => cell !== 0)) {
                    lines.push({ type: 'horizontal', row });
                }
            }
            
            // 檢查垂直線
            for (let col = 0; col < 5; col++) {
                if (board.every(row => row[col] !== 0)) {
                    lines.push({ type: 'vertical', col });
                }
            }
            
            // 檢查對角線
            if (board.every((row, i) => row[i] !== 0)) {
                lines.push({ type: 'diagonal', direction: 'main' });
            }
            
            if (board.every((row, i) => row[4-i] !== 0)) {
                lines.push({ type: 'diagonal', direction: 'anti' });
            }
            
            return lines;
        }

        // 簡化的建議系統
        function getBestSuggestion(board) {
            const emptyCells = [];
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    if (board[row][col] === 0) {
                        emptyCells.push({ row, col });
                    }
                }
            }
            
            if (emptyCells.length === 0) return null;
            
            // 簡單策略：優先選擇中心位置
            const centerCell = emptyCells.find(cell => cell.row === 2 && cell.col === 2);
            if (centerCell) return centerCell;
            
            // 否則隨機選擇
            return emptyCells[Math.floor(Math.random() * emptyCells.length)];
        }

        // 創建遊戲板
        function createGameBoard() {
            const boardElement = document.getElementById('game-board');
            boardElement.innerHTML = '';
            
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'game-cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    cell.addEventListener('click', () => handleCellClick(row, col));
                    boardElement.appendChild(cell);
                }
            }
        }

        // 處理格子點擊
        function handleCellClick(row, col) {
            if (!gameState.gameStarted || gameState.gameEnded) return;
            if (gameState.board[row][col] !== 0) return;
            
            if (gameState.gamePhase === 'player-turn') {
                gameState.board[row][col] = 1; // 玩家
                updateBoard();
                gameState.gamePhase = 'computer-turn';
                updateUI();
                showPlayerSuggestion();
            } else if (gameState.gamePhase === 'computer-turn') {
                gameState.board[row][col] = 2; // 電腦
                updateBoard();
                nextRound();
            }
        }

        // 更新遊戲板顯示
        function updateBoard() {
            const cells = document.querySelectorAll('.game-cell');
            cells.forEach((cell, index) => {
                const row = Math.floor(index / 5);
                const col = index % 5;
                const value = gameState.board[row][col];
                
                cell.className = 'game-cell';
                if (value === 1) cell.classList.add('player');
                if (value === 2) cell.classList.add('computer');
            });
            
            // 檢查連線
            gameState.completedLines = checkLines(gameState.board);
            document.getElementById('completed-lines').textContent = gameState.completedLines.length;
        }

        // 下一輪
        function nextRound() {
            if (gameState.currentRound >= 8) {
                endGame();
            } else {
                gameState.currentRound++;
                gameState.gamePhase = 'player-turn';
                updateUI();
                showPlayerSuggestion();
            }
        }

        // 結束遊戲
        function endGame() {
            gameState.gameEnded = true;
            gameState.gamePhase = 'game-over';
            updateUI();
            
            const lines = gameState.completedLines.length;
            alert(`遊戲結束！完成了 ${lines} 條連線！`);
        }

        // 更新 UI
        function updateUI() {
            document.getElementById('current-round').textContent = gameState.currentRound;
            document.getElementById('game-phase').textContent = 
                gameState.gamePhase === 'player-turn' ? '玩家回合' :
                gameState.gamePhase === 'computer-turn' ? '電腦回合' :
                gameState.gamePhase === 'game-over' ? '遊戲結束' : '等待開始';
            
            document.getElementById('restart-game').disabled = !gameState.gameStarted;
        }

        // 顯示玩家建議
        function showPlayerSuggestion() {
            const suggestion = getBestSuggestion(gameState.board);
            const suggestionText = document.getElementById('suggestion-text');
            
            if (suggestion) {
                suggestionText.textContent = `建議位置：第${suggestion.row + 1}行第${suggestion.col + 1}列`;
            } else {
                suggestionText.textContent = '沒有可用位置';
            }
        }

        // 開始遊戲
        function startGame() {
            gameState = {
                board: Array(5).fill().map(() => Array(5).fill(0)),
                currentRound: 1,
                gamePhase: 'player-turn',
                gameStarted: true,
                gameEnded: false,
                completedLines: []
            };
            
            updateBoard();
            updateUI();
            showPlayerSuggestion();
            
            document.getElementById('start-game').disabled = true;
        }

        // 重新開始
        function restartGame() {
            startGame();
            document.getElementById('start-game').disabled = false;
        }

        // 電腦隨機移動
        function makeRandomComputerMove() {
            if (gameState.gamePhase !== 'computer-turn') return;
            
            const emptyCells = [];
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    if (gameState.board[row][col] === 0) {
                        emptyCells.push({ row, col });
                    }
                }
            }
            
            if (emptyCells.length > 0) {
                const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                handleCellClick(randomCell.row, randomCell.col);
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🎮 Initializing minimal game...');
            
            // 檢查必要組件
            const missingComponents = [];
            if (typeof ProbabilityCalculator === 'undefined') missingComponents.push('ProbabilityCalculator');
            if (typeof GameEngine === 'undefined') missingComponents.push('GameEngine');
            
            if (missingComponents.length > 0) {
                console.error('Missing components:', missingComponents);
            }
            
            createGameBoard();
            updateUI();
            
            // 事件監聽器
            document.getElementById('start-game').addEventListener('click', startGame);
            document.getElementById('restart-game').addEventListener('click', restartGame);
            document.getElementById('random-computer-move').addEventListener('click', makeRandomComputerMove);
            
            console.log('✅ Minimal game initialized successfully!');
        });
    </script>
</body>
</html>